pipeline {
  agent {
    kubernetes {
      yaml '''
kind: Pod
metadata:
  name: helm
spec:
  serviceAccountName: jenkins
  containers:
  - name: helm
    image: registry.crazyzone.be/helm:latest
    imagePullPolicy: Always
    command:
    - sleep
    - infinity
'''
    }

  }
  stages {
    stage('Checking out helm branch') {
      steps {
        dir('deps') {
            checkout([ $class: 'GitSCM', branches: [[name: '*/master']], userRemoteConfigs: [[url: 'https://github.com/nvanlaerebeke/helm-docs.git']]])
        }
      }
    }
    stage('build') {
      steps {
        container(name: 'helm') {
          sh '''#!/bin/sh
/build.sh release docs home
          '''
        }
      }
    }
  }
}
